{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the ui of the phone field input.\n *\n * @module     profilefield_phone/form\n * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\nexport const init = function(name, formid) {\n    /** @type {NodeJS.Timeout} */\n    let searchTimeout;\n    /** @type {JQuery<HTMLElement>} */\n    let groupContainer;\n    /** @type {JQuery<HTMLElement>} */\n    let hiddenSelect;\n    /** @type {JQuery<HTMLElement>} */\n    let searchInput;\n    /** @type {String} */\n    let currentSelectedValue;\n\n    /**\n     * Register the event listeners.\n     */\n    function register() {\n        currentSelectedValue = hiddenSelect.val();\n        if (currentSelectedValue) {\n            searchInput.attr('placeholder', getPhoneCode(currentSelectedValue));\n        }\n\n        hiddenSelect.on('change', function() {\n            currentSelectedValue = $(this).val();\n            let code = getPhoneCode(currentSelectedValue);\n            searchInput.attr('placeholder', code);\n        });\n    }\n\n    /**\n     * Get the phone code from the country code.\n     * @param {String} country\n     */\n    function getPhoneCode(country) {\n        let text = hiddenSelect.find('option[value=\"' + country + '\"]').text();\n        return text.match(/\\+\\d+/g).shift();\n    }\n\n    /**\n     * Identify the search input.\n     * The autocomplete element in MoodleQuickForm take a while\n     * to get rendered by js and the search input to be in the DOM.\n     */\n    function identifySearchInput() {\n        clearTimeout(searchTimeout);\n        searchInput = groupContainer.find('input[type=\"text\"][data-fieldtype=\"autocomplete\"]');\n        if (searchInput.length > 0) {\n            register();\n        } else {\n            let freezed = groupContainer.find('span[data-fieldtype=\"autocomplete\"]');\n            if (freezed.length > 0 && freezed.find('select').length === 0) {\n                freezed.text(freezed.text().match(/\\+\\d+/g).shift());\n                return;\n            }\n\n            searchTimeout = setTimeout(identifySearchInput, 100);\n        }\n    }\n\n    let mform = $('form#' + formid);\n    groupContainer = mform.find('.profilefield_phone.phone-input-group.fitem[data-groupname=\"' + name + '\"]');\n    hiddenSelect = groupContainer.find('select[name=\"' + name + '[code]\"]');\n\n    // Ugly hack to remove flex-wrap class from the group.\n    // This prevent the elements code and number to be wrapped under each others.\n    groupContainer.find('div[data-fieldtype=\"group\"] fieldset div.flex-wrap').removeClass('flex-wrap');\n\n    identifySearchInput();\n};\n"],"names":["name","formid","searchTimeout","groupContainer","hiddenSelect","searchInput","currentSelectedValue","getPhoneCode","country","find","text","match","shift","mform","removeClass","identifySearchInput","clearTimeout","length","val","attr","on","this","code","freezed","setTimeout"],"mappings":";;;;;;;wJAyBoB,SAASA,KAAMC,YAE3BC,cAEAC,eAEAC,aAEAC,YAEAC,8BAsBKC,aAAaC,gBACPJ,aAAaK,KAAK,iBAAmBD,QAAU,MAAME,OACpDC,MAAM,UAAUC,YAwB5BC,OAAQ,mBAAE,QAAUZ,QACxBE,eAAiBU,MAAMJ,KAAK,+DAAiET,KAAO,MACpGI,aAAeD,eAAeM,KAAK,gBAAkBT,KAAO,YAI5DG,eAAeM,KAAK,sDAAsDK,YAAY,sBAtB7EC,yBACLC,aAAad,eACbG,YAAcF,eAAeM,KAAK,qDAC9BJ,YAAYY,OAAS,EA7BzBX,qBAAuBF,aAAac,MAChCZ,sBACAD,YAAYc,KAAK,cAAeZ,aAAaD,uBAGjDF,aAAagB,GAAG,UAAU,WACtBd,sBAAuB,mBAAEe,MAAMH,UAC3BI,KAAOf,aAAaD,sBACxBD,YAAYc,KAAK,cAAeG,aAuB7B,KACCC,QAAUpB,eAAeM,KAAK,0CAC9Bc,QAAQN,OAAS,GAAuC,IAAlCM,QAAQd,KAAK,UAAUQ,mBAC7CM,QAAQb,KAAKa,QAAQb,OAAOC,MAAM,UAAUC,SAIhDV,cAAgBsB,WAAWT,oBAAqB,MAYxDA"}