{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the ui of the phone field input.\n *\n * @module     profilefield_phone/form\n * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\nclass PhoneForm {\n    /** @type {Array<NodeJS.Timeout>} */\n    searchTimeout;\n    /** @type {JQuery<HTMLElement>} */\n    groupContainer;\n    /** @type {JQuery<HTMLElement>} */\n    hiddenSelect;\n    /** @type {JQuery<HTMLElement>} */\n    searchInput;\n    /** @type {String} */\n    currentSelectedValue;\n    /** @type {String} */\n    name;\n    /** @type {String} */\n    formid;\n\n    /**\n     * Create a phone form element class to handle phone element.\n     * @param {String} name The phone element name.\n     * @param {String} formid The mform id contains the element.\n     */\n    constructor(name, formid) {\n        this.name = name;\n        this.formid = formid;\n        timeoutFunction(this.identifyGroupCotainer.bind(this));\n    }\n\n    /**\n     * Identify the group container and hidden select element.\n     */\n    identifyGroupCotainer() {\n        let mform = $('form#' + this.formid);\n        this.groupContainer = mform.find('.profilefield_phone.phone-input-group.fitem[data-groupname=\"' + this.name + '\"]');\n        if (this.groupContainer.length === 0) {\n            return false;\n        }\n\n        this.hiddenSelect = this.groupContainer.find('select[name=\"' + this.name + '[code]\"]');\n\n        // Ugly hack to remove flex-wrap class from the group.\n        // This prevent the elements code and number to be wrapped under each others.\n        this.groupContainer.find('div[data-fieldtype=\"group\"] fieldset div.flex-wrap').removeClass('flex-wrap');\n        this.groupContainer.find('div.d-flex.align-items-center').removeClass('align-items-center');\n\n        timeoutFunction(this.identifySearchInput.bind(this));\n        return true;\n    }\n    /**\n     * Register the event listeners.\n     */\n    register() {\n        this.currentSelectedValue = this.hiddenSelect.val();\n        if (this.currentSelectedValue) {\n            this.searchInput.attr('placeholder', this.getPhoneCode(this.currentSelectedValue));\n        }\n\n        let self = this;\n        this.hiddenSelect.on('change', function() {\n            self.currentSelectedValue = $(this).val();\n            let code = self.getPhoneCode(self.currentSelectedValue);\n            self.searchInput.attr('placeholder', code);\n        });\n    }\n\n    /**\n     * Get the phone code from the country code.\n     * @param {String} country\n     */\n    getPhoneCode(country) {\n        let text = this.hiddenSelect.find('option[value=\"' + country + '\"]').text();\n        return text.match(/\\+\\d+/g).shift();\n    }\n\n    /**\n     * Identify the search input.\n     * The autocomplete element in MoodleQuickForm take a while\n     * to get rendered by js and the search input to be in the DOM.\n     */\n    identifySearchInput() {\n        clearTimeout(this.searchTimeout);\n        this.searchInput = this.groupContainer.find('input[type=\"text\"][data-fieldtype=\"autocomplete\"]');\n        if (this.searchInput.length > 0) {\n            this.register();\n            return true;\n        } else {\n            let freezed = this.groupContainer.find('span[data-fieldtype=\"autocomplete\"]');\n            if (freezed.length > 0 && freezed.find('select').length === 0) {\n                freezed.text(freezed.text().match(/\\+\\d+/g).shift());\n                return true;\n            }\n        }\n        return false;\n    }\n}\n\n/**\n * @param {Function} fun\n */\nfunction timeoutFunction(fun) {\n    setTimeout(function() {\n        let done = fun();\n        if (!done) {\n            timeoutFunction(fun, 500);\n        }\n    });\n}\n\nexport const init = function(name, formid) {\n    new PhoneForm(name, formid);\n};\n"],"names":["PhoneForm","searchTimeout","groupContainer","hiddenSelect","searchInput","currentSelectedValue","name","formid","constructor","timeoutFunction","this","identifyGroupCotainer","bind","mform","find","length","removeClass","identifySearchInput","register","val","attr","getPhoneCode","self","on","code","country","text","match","shift","clearTimeout","freezed","fun","setTimeout"],"mappings":";;;;;;;gJAyBMA,UAEFC,cAEAC,eAEAC,aAEAC,YAEAC,qBAEAC,KAEAC,OAOAC,YAAYF,KAAMC,aACTD,KAAOA,UACPC,OAASA,OACdE,gBAAgBC,KAAKC,sBAAsBC,KAAKF,OAMpDC,4BACQE,OAAQ,mBAAE,QAAUH,KAAKH,oBACxBL,eAAiBW,MAAMC,KAAK,+DAAiEJ,KAAKJ,KAAO,MAC3E,IAA/BI,KAAKR,eAAea,cAInBZ,aAAeO,KAAKR,eAAeY,KAAK,gBAAkBJ,KAAKJ,KAAO,iBAItEJ,eAAeY,KAAK,sDAAsDE,YAAY,kBACtFd,eAAeY,KAAK,iCAAiCE,YAAY,sBAEtEP,gBAAgBC,KAAKO,oBAAoBL,KAAKF,QACvC,GAKXQ,gBACSb,qBAAuBK,KAAKP,aAAagB,MAC1CT,KAAKL,2BACAD,YAAYgB,KAAK,cAAeV,KAAKW,aAAaX,KAAKL,2BAG5DiB,KAAOZ,UACNP,aAAaoB,GAAG,UAAU,WAC3BD,KAAKjB,sBAAuB,mBAAEK,MAAMS,UAChCK,KAAOF,KAAKD,aAAaC,KAAKjB,sBAClCiB,KAAKlB,YAAYgB,KAAK,cAAeI,SAQ7CH,aAAaI,gBACEf,KAAKP,aAAaW,KAAK,iBAAmBW,QAAU,MAAMC,OACzDC,MAAM,UAAUC,QAQhCX,yBACIY,aAAanB,KAAKT,oBACbG,YAAcM,KAAKR,eAAeY,KAAK,qDACxCJ,KAAKN,YAAYW,OAAS,cACrBG,YACE,EACJ,KACCY,QAAUpB,KAAKR,eAAeY,KAAK,0CACnCgB,QAAQf,OAAS,GAAuC,IAAlCe,QAAQhB,KAAK,UAAUC,cAC7Ce,QAAQJ,KAAKI,QAAQJ,OAAOC,MAAM,UAAUC,UACrC,SAGR,YAONnB,gBAAgBsB,KACrBC,YAAW,WACID,OAEPtB,gBAAgBsB,sBAKR,SAASzB,KAAMC,YAC3BP,UAAUM,KAAMC"}